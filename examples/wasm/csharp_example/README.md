# C# (.NET) to WASM Example: Greet, Add & Complex Calculation

This example demonstrates how to compile C# methods to WebAssembly (WASM) using the .NET SDK (specifically .NET 8 in this setup) and call them from JavaScript in a web browser. This approach uses the built-in WASM support in .NET, suitable for non-Blazor scenarios where you want to run .NET code in the browser.

The example exposes three C# static methods:
- `MyLibrary.Greet(string name)`: Returns a greeting string.
- `MyLibrary.Add(int a, int b)`: Returns the sum of two integers.
- `MyLibrary.ComplexCalculation(string input)`: Simulates a more complex operation and returns a processed string.

These methods are exported to JavaScript using the `[JSExport]` attribute.

## Files

- `CSharpWasmLib/`: This directory contains the C# class library project.
    - `MyLibrary.cs`: Contains the C# source code with the static methods (`Greet`, `Add`, `ComplexCalculation`) decorated with `[JSExport]`.
    - `CSharpWasmLib.csproj`: The C# project file, configured for WASM compilation (`<RuntimeIdentifier>browser-wasm</RuntimeIdentifier>`, `<WasmEnableJSInterop>true</WasmEnableJSInterop>`).
- `build.sh`: A shell script that:
    - Navigates into the `CSharpWasmLib` directory.
    - Runs `dotnet publish -c Release -r browser-wasm` to compile the C# project to WASM.
    - Copies the essential output files (like `dotnet.js`, `dotnet.wasm`, and `CSharpWasmLib.dll`) from the build output (`CSharpWasmLib/bin/Release/net8.0/browser-wasm/AppBundle/`) into a local `dist/` directory at the root of the `csharp_example`.
- `index.html`: The main HTML page that loads the .NET WASM runtime and provides a UI to interact with the C# functions.
- `script.js`: JavaScript ES6 module that:
    - Imports the `dotnet` runtime from `./dist/dotnet.js`.
    - Initializes the .NET runtime.
    - Retrieves the exported C# methods using `getAssemblyExports`.
    - Handles UI events and calls the C# methods.
- `dist/` (Generated by `build.sh`): This directory contains the necessary files to run the WASM module in the browser, including:
    - `dotnet.js`: The JavaScript glue code to bootstrap and manage the .NET WASM runtime.
    - `dotnet.wasm`: The .NET runtime compiled to WebAssembly.
    - `CSharpWasmLib.dll`: The compiled C# library (and its dependencies if any).
    - Other related JSON and PDB files.

## Prerequisites

1.  **.NET SDK**: Install the .NET SDK (Version 8.0 was used for this example, but .NET 6+ should generally work with minor adjustments to TargetFramework in `.csproj` and `build.sh`). You can download it from [dot.net](https://dot.net/download).
2.  **WASM Tools Workload**: Install the WASM tools workload for your .NET SDK. For .NET 8:
    ```bash
    dotnet workload install wasm-tools
    ```
    (For older .NET versions like .NET 6, it might be `wasm-tools-net6` or similar. Check `dotnet workload search wasm` if unsure.)

## How to Build

1.  Navigate to the C# example directory:
    ```bash
    cd examples/wasm/csharp_example
    ```
2.  Make the build script executable (if it isn't already):
    ```bash
    chmod +x build.sh
    ```
3.  Run the build script:
    ```bash
    ./build.sh
    ```
    This script will compile the C# project and copy the necessary runtime and library files into the `dist/` directory. Check the script's output for success or errors.

## How to Run

1.  After successfully building the WASM module (the `dist/` directory is populated), you need to serve the `examples/wasm/csharp_example/` directory using a local web server. Browsers typically restrict loading WASM files and related JS modules directly from the local file system due to security policies.

2.  A simple way to start a web server (if you have Python 3) from the `examples/wasm/csharp_example/` directory is:
    ```bash
    python -m http.server
    ```
    Or for Python 2:
    ```bash
    python -m SimpleHTTPServer
    ```
    This will usually serve files from the current directory at `http://localhost:8000`.

3.  Open your web browser and navigate to `http://localhost:8000/index.html` (or the appropriate URL if your server uses a different port).

4.  You should see the UI with input fields and buttons. The status message will indicate if the .NET WASM runtime is loading/initialized. Once initialized, you can interact with the C# functions. Check the browser's developer console for detailed messages from `script.js` and the .NET runtime.

## Notes

-   **`[JSExport]` Attribute**: This attribute (from `System.Runtime.InteropServices.JavaScript`) is used in `MyLibrary.cs` to mark C# methods that should be callable from JavaScript.
-   **`.csproj` Configuration**:
    -   `<RuntimeIdentifier>browser-wasm</RuntimeIdentifier>` tells the .NET SDK to target the browser's WASM environment.
    -   `<OutputType>Exe</OutputType>` is often required for the `browser-wasm` workload, even if you're essentially building a library of functions.
    -   `<WasmEnableJSInterop>true</WasmEnableJSInterop>` is crucial for `[JSExport]` and `[JSImport]` to work in .NET 7+ non-Blazor projects.
-   **JavaScript Interop (`script.js`)**:
    -   The `dotnet.js` file (in `dist/`) is the entry point for the .NET WASM runtime.
    -   `await dotnet.create()` initializes the runtime.
    -   `getAssemblyExports(config.mainAssemblyName)` is used to get access to the `[JSExport]`-ed C# methods. The `mainAssemblyName` usually defaults to your project's assembly name (e.g., "CSharpWasmLib").
    -   Exported static C# methods are then callable like `exports.Namespace.ClassName.MethodName` or `exports.ClassName.MethodName` if the C# class has no namespace.
-   **Build Output**: The `build.sh` script copies the necessary artifacts into the `dist/` folder to make it easy to serve the example. This includes the .NET runtime (`dotnet.wasm`), the JS loader (`dotnet.js`), your compiled C# code (`CSharpWasmLib.dll`), and potentially other files like `icudt.dat` for internationalization.

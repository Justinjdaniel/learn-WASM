# C to WASM Factorial Example

This example demonstrates how to compile a simple C function to WebAssembly (WASM) and call it from JavaScript in a web browser. The C function calculates the factorial of a given integer.

## Files

- `factorial.c`: Contains the C source code for the `factorial` function. It includes `emscripten.h` and uses `EMSCRIPTEN_KEEPALIVE` to ensure the function isn't removed by dead code elimination.
- `compile.sh`: A shell script to compile `factorial.c` into `factorial.wasm` and the corresponding JavaScript glue code (`factorial.js`) using Emscripten.
- `index.html`: The main HTML page that loads the WASM module and provides a simple UI to input a number and see the factorial result.
- `script.js`: JavaScript code that handles the WASM module loading, user input, calling the WASM `factorial` function (via `Module.ccall`), and displaying the output or errors.
- `factorial.js` (Generated): This file is generated by Emscripten during compilation. It contains the JavaScript glue code needed to load and run `factorial.wasm`.
- `factorial.wasm` (Generated): The compiled WebAssembly module.

## Prerequisites

- **Emscripten SDK**: You need to have the Emscripten SDK installed and configured in your environment. If you haven't sourced its environment script, you might need to do so. For example:
  ```bash
  source /path/to/emsdk/emsdk_env.sh
  ```
  Refer to the [official Emscripten documentation](https://emscripten.org/docs/getting_started/downloads.html) for installation instructions.

## How to Build

1.  Navigate to the `examples/wasm/c_example` directory:
    ```bash
    cd examples/wasm/c_example
    ```
2.  Make the compile script executable (if it isn't already):
    ```bash
    chmod +x compile.sh
    ```
3.  Run the compilation script:
    ```bash
    ./compile.sh
    ```
    This will generate `factorial.wasm` and `factorial.js`. If successful, you'll see a confirmation message.

## How to Run

1.  After successfully building the WASM module (`factorial.wasm` and `factorial.js` are present), you need to serve the files using a local web server. Browsers typically restrict loading WASM files directly from the local file system due to security policies (CORS).

2.  A simple way to start a web server (if you have Python 3) is:
    ```bash
    python -m http.server
    ```
    Or for Python 2:
    ```bash
    python -m SimpleHTTPServer
    ```
    This will usually serve files from the current directory at `http://localhost:8000`.

3.  Open your web browser and navigate to `http://localhost:8000/index.html` (or the appropriate URL if your server uses a different port).

4.  You should see an input field and a button. Enter a non-negative integer and click "Calculate Factorial" to see the result computed by the WASM module.

## Notes

- The `EMSCRIPTEN_KEEPALIVE` macro in `factorial.c` is important. Without it, Emscripten might optimize away the `factorial` function if it doesn't see it being directly called by other C code.
- The `compile.sh` script uses `emcc` (Emscripten Compiler Frontend) with specific flags:
    - `-s WASM=1`: Specifies that we want WASM output.
    - `-s EXPORTED_FUNCTIONS="['_factorial']"`: Tells Emscripten which C functions to make available for calling from JavaScript. The underscore prefix is common for C compiled names.
    - `-s EXTRA_EXPORTED_RUNTIME_METHODS="['ccall', 'cwrap']"`: Exports Emscripten helper functions `ccall` (to call C functions directly) and `cwrap` (to create a JavaScript wrapper around a C function).
    - `-O3`: Optimization level.
- The `script.js` waits for `Module.onRuntimeInitialized` before enabling the button, ensuring that the WASM module is loaded and ready.
- Error handling is basic. For production applications, more robust error checking and user feedback would be needed.
